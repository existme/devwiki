# Services

## Raspberry Pie (and the related products)
<note></note> This is mainly a copy of Johannes Gehrs [post][jg-link] on medium.

###Installation
Install systemd by installing the packages <mark>systemd</mark> and <red-h>systemd-sysv</red-h>:
~~~sh
apt-get install systemd systemd-sysv
~~~

###Checking the Status of Services
Use <ic>systemctl</ic> command without parameters for listing all the running services.
To look at one specific service (for example transmission-daemon) issue 
<ic>systemctl status <red>transmission-daemon</red></ic>.

###Stopping, Starting, Restarting and Reloading Services
For Stopping a service issue <ic>sudo systemctl <red>stop</red> transmission-daemon</ic>.
For Starting it issue <ic>sudo systemctl <red>start</red> transmission-daemon</ic>. To
Restart it issue <ic>sudo systemctl <red>restart</red> transmission-daemon</ic>.
systemd also has a generic way to issue the soft reload that transmission-daemon and 
many other services support: <ic>sudo systemctl <red>reload</red> transmission-daemon</ic>.

###Understanding the Journal
The systemctl commands will not write it to standard output. systemd writes
the output of init scripts and all status messages generated by systemd 
to something called _journal_. You can get the last relevant lines of 
output from the status command, by issuing: 
<ic>systemctl status transmission-daemon</ic> but the status will not show
the log entries unless you run it with root privileges.

So for getting the last log-messages use <ic><red>sudo</red> systemctl status transmission-daemon</ic>
instead. To see the full log issue <ic>sudo journalctl -u transmission-daemon</ic>
 
###Permanently Enabling or Disabling Services

To disable a service issue: <ic>sudo systemctl disable transmission-daemon</ic>. 
Respectively use: <ic>sudo systemctl enable transmission-daemon</ic> to
enable a service.

<note></note> You can still manually start or stop services even if they are 
enabled or disabled. It just means that they wonâ€™t start or stop at boot.

If you actually want to make it impossible that the service is started you can mask it:
~~~bash
systemctl mask transmission-daemon
~~~
Respectively, to unmask you should issue:
~~~bash
systemctl unmask transmission-daemon
~~~
<note></note> Issuing disable, enable; mask or unmask will not start or 
stop the service. You need to do this separately.

###Understanding Service Files
Service files are located in <ic>/lib/systemd/system</ic> 


## Sample mount service using <ic>serviced</ic>
Let's assume that we want to write a service which automatically will 
mount a <ic>sshfs</ic> file system after system is booted and network is 
up. We can't just simply add it to <ic>fstab</ic> because at that time
network might not be available. Let's assume that we want to mount the
filesystem into this folder: <ic>/media/pi/WD</ic>.

### Creating the service file
Inorder to proceed, you need to create a file **exactly** with this name
and in this path: <ic>/etc/systemd/system/media-pi-WD.mount</ic>. The file
should look like as follows:
~~~shell
[Unit]
Description=WD Sshfs mount
Requires=network-online.target
After=netctl@enp0s25.service

[Mount]
What=root@192.168.0.50:/DataVolume/shares/WD
Where=/media/pi/WD
Type=fuse.sshfs
Options=_netdev,user,idmap=user,default_permissions,uid=vagrant,gid=pi,allow_other,transform_symlinks

[Install]
WantedBy=multi-user.target
~~~
### Enabling the service
Next, we need to enable the service, by issuing:
~~~shell
sudo systemctl enable media-pi-WD.mount
~~~
### Query the status of the service
To see how the server is doing you can start it manually, by issuing:
~~~shell
sudo systemctl start media-pi-WD.mount
~~~
And then query its status by entering:
~~~shell
sudo systemctl status media-pi-WD.mount
~~~

[jg-link]: https://medium.com/@johannes_gehrs/getting-started-with-systemd-on-debian-jessie-e024758ca63d#.h0c3zxsxl